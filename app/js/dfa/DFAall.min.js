function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){t.config.states.push(new State(e,a,n,i));return t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);if(t.existsTransition(n.fromState,n.toState,a))return!1;t.getTransitionById(e);return t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){t.config.states.push(new State(e,a,n,i));return t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);if(t.existsTransition(n.fromState,n.toState,a))return!1;t.getTransitionById(e);return t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){t.config.states.push(new State(e,a,n,i));return t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);if(t.existsTransition(n.fromState,n.toState,a))return!1;t.getTransitionById(e);return t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){t.config.states.push(new State(e,a,n,i));return t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);if(t.existsTransition(n.fromState,n.toState,a))return!1;t.getTransitionById(e);return t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,
e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle");return a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){if(l.input.tttisopen=!1,e!==a)if(""===e||t.existsStateWithName(e))""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST");else{!t.renameState(l.input.state.id,e)}}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name;_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[];t.config;_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){
return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){
e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle");return a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){if(l.input.tttisopen=!1,e!==a)if(""===e||t.existsStateWithName(e))""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST");else{!t.renameState(l.input.state.id,e)}}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;
var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name;_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[];t.config;_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),
l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,
e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){
t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],
t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle");return a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){if(l.input.tttisopen=!1,e!==a)if(""===e||t.existsStateWithName(e))""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST");else{!t.renameState(l.input.state.id,e)}}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name;_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){
var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[];t.config;_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y]);
},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),
t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);
var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),
null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,
l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function DFA(t,e){"use strict";window.debugScope=t,t.defaultConfig={},t.defaultConfig.statePrefix="S",t.defaultConfig.transitionNameSuffix="|",t.defaultConfig.diagramm={x:0,y:0,scale:1,updatedWithZoomBehavior:!1},t.defaultConfig.countStateId=0,t.defaultConfig.countTransitionId=0,t.defaultConfig.states=[],t.defaultConfig.startState=null,t.defaultConfig.finalStates=[],t.defaultConfig.transitions=[],t.defaultConfig.alphabet=[],t.defaultConfig.inputWord="",t.defaultConfig.name="Untitled Automaton",t.defaultConfig.unSavedChanges=!1,t.defaultConfig.drawnTransitions=[],t.config=cloneObject(t.defaultConfig),t.updateListeners=[],t.simulator=new SimulationDFA(t),t.table=new TableDFA(t),t.statediagram=new StateDiagramDFA(t,"#diagramm-svg"),t.statetransitionfunction=new StatetransitionfunctionDFA(t),t.testData=new TestData(t),t.inNameEdit=!1,t.showModalWithMessage=function(e,a,n,i){t.title=e,t.description=a,t.modalAction=n,void 0===i?t.button="MODAL_BUTTON.PROCEED":t.button=i,$("#modal").modal()},t.executeModalAction=function(){t.$eval(t.modalAction)},t.stepTimeOutSlider={options:{floor:0,step:100,ceil:3e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.loopTimeOutSlider={options:{floor:0,step:100,ceil:4e3,hideLimitLabels:!0,translate:function(t){return t+" ms"}}},t.keypressCallback=function(t){13==t.charCode&&document.getElementById("automatonNameEdit").blur()},window.onbeforeunload=function(e){if(t.config.unSavedChanges){var a="All Changes will be Lost. Save before continue!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}},t.saveAutomaton=function(){t.config.unSavedChanges=!1},t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},t.resetAutomaton=function(){t.statediagram.clearSvgContent(),t.simulator.reset(),t.config=cloneObject(t.defaultConfig),t.safeApply(),t.updateListener()},t.addToAlphabet=function(e){_.some(t.config.alphabet,function(t){return t===e})||t.config.alphabet.push(e)},t.removeFromAlphabetIfNotUsedFromOthers=function(e){for(var a=t.getTransitionById(e),n=!1,i=0;i<t.config.transitions.length;i++)if(a.name===t.config.transitions[i].name&&t.config.transitions[i].id!==e)return void(n=!0);return n?!1:(_.pull(t.config.alphabet,a.name),!0)},t.updateListener=function(){_.forEach(t.updateListeners,function(t,e){t.updateFunction()}),t.config.unSavedChanges=!0},t.existsStateWithName=function(e,a){var n=!1;return _.forEach(t.config.states,function(t){return t.name==e&&t.id!==a?void(n=!0):void 0}),n},t.existsStateWithId=function(e){for(var a=0;a<t.config.states.length;a++)if(t.config.states[a].id==e)return!0;return!1},t.hasStateTransitions=function(e){var a=!1;return _.forEach(t.config.transitions,function(t){t.fromState!=e&&t.toState!=e||(a=!0)}),a},t.getArrayStateIdByStateId=function(e){return _.findIndex(t.config.states,function(t){return t.id==e?t:void 0})},t.getStateById=function(e){return t.config.states[t.getArrayStateIdByStateId(e)]},t.getStateByName=function(e){return t.config.states[t.getArrayStateIdByStateId(function(t){})]},t.addStateWithPresets=function(e,a){var n=t.addState(t.config.statePrefix+t.config.countStateId,e,a);return 1==t.config.countStateId&&t.changeStartState(0),n},t.addState=function(e,a,n){return t.existsStateWithName(e)?null:t.addStateWithId(t.config.countStateId++,e,a,n)},t.addStateWithId=function(e,a,n,i){return t.config.states.push(new State(e,a,n,i)),t.statediagram.drawState(e),t.updateListener(),t.safeApply(),t.getStateById(e)},t.removeState=function(e){t.hasStateTransitions(e)?t.showModalWithMessage("STATE_MENU.DELETE_MODAL_TITLE","STATE_MENU.DELETE_MODAL_DESC","forcedRemoveState("+e+")","MODAL_BUTTON.DELETE"):(t.isStateAFinalState(e)&&t.removeFinalState(e),t.config.startState==e&&(t.config.startState=null),t.statediagram.removeState(e),t.config.states.splice(t.getArrayStateIdByStateId(e),1),t.updateListener())},t.forcedRemoveState=function(e){for(var a=0;a<t.config.transitions.length;a++){var n=t.config.transitions[a];n.fromState!==e&&n.toState!==e||(t.removeTransition(n.id),a--)}t.removeState(e)},t.renameState=function(e,a){return t.existsStateWithName(a)?!1:(t.getStateById(e).name=a,t.statediagram.renameState(e,a),t.updateListener(),!0)},t.changeStartState=function(e){t.existsStateWithId(e)&&(t.statediagram.changeStartState(e),t.config.startState=e,t.updateListener())},t.removeStartState=function(){null!==t.config.startState&&(t.statediagram.removeStartState(),t.updateListener(),t.config.startState=null)},t.getFinalStateIndexByStateId=function(e){return _.indexOf(t.config.finalStates,e)},t.isStateAFinalState=function(e){for(var a=0;a<t.config.finalStates.length;a++)if(t.config.finalStates[a]==e)return!0;return!1},t.addFinalState=function(e){t.isStateAFinalState(e)||(t.config.finalStates.push(e),t.statediagram.addFinalState(e),t.updateListener())},t.removeFinalState=function(e){t.isStateAFinalState(e)&&(t.statediagram.removeFinalState(e),t.updateListener(),t.config.finalStates.splice(t.getFinalStateIndexByStateId(e),1))},t.existsTransition=function(e,a,n,i){for(var r=!1,s=0;s<t.config.transitions.length;s++){var o=t.config.transitions[s];o.fromState==e&&o.name==n&&o.id!==i&&(r=!0)}return r},t.getNextTransitionName=function(e){for(var a=[],n=0;n<t.config.transitions.length;n++)t.config.transitions[n].fromState==e&&a.push(t.config.transitions[n].name);for(var i=!1,r="a";!i;){var s=_.indexOf(a,r);-1===s?i=!0:r=String.fromCharCode(r.charCodeAt()+1)}return r},t.addTransition=function(e,a,n){return!t.existsTransition(e,a,n)&&t.existsStateWithId(e)&&t.existsStateWithId(a)?(t.addToAlphabet(n),t.addTransitionWithId(t.config.countTransitionId++,e,a,n)):void 0},t.addTransitionWithId=function(e,a,n,i){return t.config.transitions.push(new TransitionDFA(e,a,n,i)),t.statediagram.drawTransition(e),t.updateListener(),t.safeApply(),t.getTransitionById(e)},t.getArrayTransitionIdByTransitionId=function(e){return _.findIndex(t.config.transitions,function(t){return t.id==e?t:void 0})},t.getTransitionById=function(e){return t.config.transitions[t.getArrayTransitionIdByTransitionId(e)]},t.getTransition=function(e,a,n){for(var i=0;i<t.config.transitions.length;i++){var r=t.config.transitions[i];if(r.fromState==e&&r.toState==a&&r.name==n)return r}},t.removeTransition=function(e){t.removeFromAlphabetIfNotUsedFromOthers(e),t.statediagram.removeTransition(e),t.config.transitions.splice(t.getArrayTransitionIdByTransitionId(e),1),t.updateListener()},t.renameTransition=function(e,a){var n=t.getTransitionById(e);return t.existsTransition(n.fromState,n.toState,a)?!1:(t.getTransitionById(e),t.removeFromAlphabetIfNotUsedFromOthers(e),t.addToAlphabet(a),t.getTransitionById(e).name=a,t.statediagram.renameTransition(n.fromState,n.toState,e,a),t.updateListener(),!0)}}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){
a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar;
}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,
e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);return n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle"),a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){l.input.tttisopen=!1,e!==a&&(""===e||t.existsStateWithName(e)?""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST"):!t.renameState(l.input.state.id,e))}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name,_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[],t.config,_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){
var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}function SimulationDFA(t){"use strict";var e=this;e.isInPlay=!1,e.loopSimulation=!0,e.stepTimeOut=1500,e.loopTimeOut=2e3,e.simulationPaused=!1,e.simulationSettings=!0,e.currentState=null,e.nextState=null,e.transition=null,e.isInputAccepted=!1,e.settings=function(){e.simulationSettings=!e.simulationSettings},e.animated={currentState:null,transition:null,nextState:null},e.reset=function(){e.animated={currentState:null,transition:null,nextState:null},e.goneTransitions=[],e.currentState=t.config.startState,e.transition=null,e.animatedTransition=!1,e.nextState=null,e.animatedNextState=!1,e.isNextStepCalculated=!1,e.simulationStarted=!1,e.statusSequence=[t.config.startState],e.madeSteps=0,e.inputWord=t.config.inputWord,e.processedWord="",e.nextChar="",e.status="stopped"},e.pause=function(){e.simulationPaused||(e.simulationPaused=!0,e.isInPlay=!1)},e.stop=function(){e.pause(),e.reset()},e.play=function(){e.simulationPaused||(e.simulationStarted?((e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&(e.animateNextMove(),t.safeApply(function(){}),(e.isNextStepCalculated||"accepted"!=e.status&&"not accepted"!=e.status)&&setTimeout(e.play,e.stepTimeOut)),e.isNextStepCalculated||"accepted"!=e.status||(e.loopSimulation?setTimeout(e.play,e.loopTimeOut):e.isInPlay=!1,e.simulationStarted=!1,t.safeApply(function(){}))):e.prepareSimulation())},e.prepareSimulation=function(){e.reset(),e.simulationStarted=!0,e.animated.currentState=_.last(e.statusSequence),t.safeApply(),setTimeout(e.play,e.loopTimeOut)},e.animateNextMove=function(){e.isNextStepCalculated||e.calcNextStep(),e.animatedTransition?!e.animatedNextState&&e.animatedTransition?(e.animatedNextState=!0,e.animated.nextState=e.nextState):e.animatedTransition&&e.animatedNextState&&(e.animated.transition=null,e.animated.nextState=null,e.animated.currentState=e.nextState,e.currentState=e.nextState,e.madeSteps++,e.inputWord.length==e.madeSteps&&(_.include(t.config.finalStates,e.currentState)?e.status="accepted":e.status="not accepted"),e.isNextStepCalculated=!1,e.animatedNextState=!1,e.animatedTransition=!1,e.processedWord+=e.nextChar,e.statusSequence.push(e.currentState),"accepted"!==e.status&&"not accepted"!==e.status&&e.calcNextStep()):(e.animatedTransition=!0,e.animated.transition=e.transition,e.goneTransitions.push(e.transition))},e.calcNextStep=function(){return e.isNextStepCalculated=!0,e.status="step",e.nextChar=e.inputWord[e.madeSteps],e.transition=_.filter(t.config.transitions,function(t){return void 0===e.nextChar?void(e.status="not accepted"):t.fromState==_.last(e.statusSequence)&&t.name==e.nextChar}),_.isEmpty(e.transition)?(e.transition=null,void(e.status="not accepted")):(e.transition=e.transition[0],void(e.nextState=e.transition.toState))},e.stepForward=function(){if(e.simulationPaused||e.pause(),e.simulationStarted){if(!_.include(["step","stopped","accepted","not accepted"],e.status))return void console.log(e.status);_.include(["accepted","not accepted"],e.status)||e.animateNextMove()}else e.prepareSimulation(),e.status="step"},e.stepBackward=function(){e.simulationPaused||e.pause(),_.include(["step","accepted","not accepted"],e.status)&&(e.status="step",e.animatedTransition||e.animatedNextState||0!==e.madeSteps?e.animateLastMove():e.reset())},e.animateLastMove=function(){console.log(e.animatedTransition+" "+e.animatedNextState),e.animatedTransition&&e.animatedNextState?(e.animated.nextState=null,e.animatedNextState=!1):e.animatedTransition?(e.animated.transition=null,e.animatedTransition=!1,e.goneTransitions.pop()):e.calcLastStep()},e.calcLastStep=function(){e.nextChar=e.processedWord.slice(-1),console.log(e.nextChar+" "+e.statusSequence[e.statusSequence.length-2]),e.transition=_.last(e.goneTransitions),console.log(e.transition),_.pullAt(e.goneTransitions,e.goneTransitions.length),e.animatedTransition=!0,e.animated.transition=e.transition;var t=e.currentState;e.currentState=e.transition.fromState,e.nextState=t,e.animated.nextState=e.nextState,e.animatedNextState=!0,e.animated.currentState=e.currentState,e.madeSteps--,e.statusSequence.splice(-1,1),e.processedWord=e.processedWord.slice(0,-1)},e.getNextTransition=function(e,a){for(var n=0;n<t.config.transitions.length;n++){var i=t.config.transitions[n];if(i.fromState==e&&i.name==a)return i}},e.check=function(){var a=!1,n=[];n.push(t.config.startState);for(var i="",r=0,s=null;r<=t.config.inputWord.length&&(i=t.config.inputWord[r],s=e.getNextTransition(_.last(n),i),!_.isEmpty(s));)if(n.push(s.toState),r++,t.config.inputWord.length==r){if(_.include(t.config.finalStates,_.last(n))){a=!0;break}break}return a},e.isPlayable=function(){return t.config.states.length>=1&&t.config.transitions.length>=1&&null!==t.config.startState&&t.config.finalStates.length>=1},e.playOrPause=function(){e.isPlayable()&&(e.isInPlay=!e.isInPlay,e.isInPlay?(e.simulationPaused=!1,e.play()):e.pause())},t.updateListeners.push(e),e.updateFunction=function(){e.isInputAccepted=e.check()}}function StateDiagramDFA(t,e){"use strict";function a(t,e){var a={x:t.y*e.z,y:-t.x*e.z};return a}function n(t){return t*(180/Math.PI)}function i(t){return t*(Math.PI/180)}function r(t,e){return{x:t.x*e,y:t.y*e}}function s(t){var e=1/Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x*e,y:t.y*e}}function o(t,e){var a=(t.x*e.x+t.y*e.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.acos(a);return{val:a,rad:i,degree:n(i)}}function c(t,e){var a=t.x*e.x+t.y*e.y,n=t.x*e.y-t.y*e.x;return Math.atan2(n,a)}function d(t,e){var a=n(c(t,e));0>a&&(a+=360);var i=a+g;i>360&&(i-=360);var r=a-g;return 0>r&&(r+=360),{angle:a,lowerAngle:r,upperAngle:i}}var l=this;l.preventStateDragging=!1,l.inAddTransition=!1,l.selectedState=null,l.preventSvgOuterClick=!1,l.selectedTransition=null,l.showStateMenu=!1,l.showTransitionMenu=!1,l.selectedStateName="selectedForTransition",l.snapping=!0,l.settings={stateRadius:25,finalStateRadius:29,selected:!1};var u=40,f=18;l.stateSelfReferenceNumber=Math.sin(45*(Math.PI/180))*l.settings.stateRadius,l.existsDrawnTransition=function(e,a){for(var n=!1,i=0;i<t.config.drawnTransitions.length;i++){var r=t.config.drawnTransitions[i];r.fromState==e&&r.toState==a&&(n=!0)}return n},l.getDrawnTransition=function(e,a){for(var n=0;n<t.config.drawnTransitions.length;n++){var i=t.config.drawnTransitions[n];if(i.fromState==e&&i.toState==a)return i}},l.clearSvgContent=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgTransitions.html(""),l.svgStates.html(""),t.config.drawnTransitions=[],l.svg.attr("transform","translate("+t.defaultConfig.diagramm.x+","+t.defaultConfig.diagramm.y+") scale("+t.defaultConfig.diagramm.scale+")"),m.scale(t.defaultConfig.diagramm.scale),m.translate([t.defaultConfig.diagramm.x,t.defaultConfig.diagramm.y])},l.zoomMax=2.5,l.zoomMin=.5,l.zoomValue=.1,l.zoomIn=function(){t.config.diagramm.scale=t.config.diagramm.scale+l.zoomValue>l.zoomMax?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale+l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomOut=function(){t.config.diagramm.scale=t.config.diagramm.scale-l.zoomValue<=l.zoomMin?t.config.diagramm.scale:Math.floor(100*(t.config.diagramm.scale-l.zoomValue))/100,l.updateZoomBehaviour()},l.zoomTo=function(e){console.log("zoomtedto"),t.config.diagramm.scale=e/100,t.safeApply(),l.updateZoomBehaviour()},l.updateZoomBehaviour=function(){t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")"),m.scale(t.config.diagramm.scale),m.translate([t.config.diagramm.x,t.config.diagramm.y])},l.zoomFitWindow=function(){var e,a=[],n=[],i=0,r=0,s=0,o=0,c=0,d=0,u=l.svgOuter.style("width").replace("px",""),f=l.svgOuter.style("height").replace("px","");if(t.config.diagramm.scale=1,t.config.states.length>0){for(e=0;e<t.config.states.length;e++)a[e]=t.config.states[e].x;for(e=0;e<t.config.states.length;e++)n[e]=t.config.states[e].y;for(i=_.min(a),r=_.max(a),s=_.min(n),o=_.max(n);r-i+150>u/t.config.diagramm.scale||o-s+200>f/t.config.diagramm.scale;)t.config.diagramm.scale-=.01;t.safeApply(),c=(f/t.config.diagramm.scale-(o-s))/2,d=(u/t.config.diagramm.scale-(r-i))/2,t.config.diagramm.x=-(i*t.config.diagramm.scale)+d*t.config.diagramm.scale,t.config.diagramm.y=-(s*t.config.diagramm.scale)+c*t.config.diagramm.scale,l.updateZoomBehaviour()}else l.scaleAndTranslateToDefault()},l.scaleAndTranslateToDefault=function(){t.config.diagramm.scale=t.defaultConfig.diagramm.scale,t.config.diagramm.x=t.defaultConfig.diagramm.x,t.config.diagramm.y=t.defaultConfig.diagramm.y,t.safeApply(),l.updateZoomBehaviour()};var m=d3.behavior.zoom().scaleExtent([l.zoomMin,l.zoomMax]).on("zoom",function(){var e=d3.event.button||d3.event.ctrlKey;if(e&&d3.event.stopImmediatePropagation(),3!==d3.event.sourceEvent.which){var a=Math.floor(100*d3.event.scale)/100;t.config.diagramm.scale=a,t.config.diagramm.x=d3.event.translate[0],t.config.diagramm.y=d3.event.translate[1],t.safeApply(),l.svg.attr("transform","translate("+t.config.diagramm.x+","+t.config.diagramm.y+") scale("+t.config.diagramm.scale+")")}else console.log("rightclick!")});l.svgOuter=d3.select(e).call(m).on("dblclick.zoom",null).on("contextmenu",function(){d3.event.preventDefault()}),l.addSvgOuterClickListener=function(){l.svgOuter.on("click",function(){l.preventSvgOuterClick?l.preventSvgOuterClick=!1:(l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply())})},l.addSvgOuterClickListener(),l.svgGrid=l.svgOuter.append("g").attr("id","grid"),l.svg=l.svgOuter.append("g").attr("id","svg-items"),l.svgTransitions=l.svg.append("g").attr("id","transitions"),l.svgStates=l.svg.append("g").attr("id","states"),l.gridSpace=100,l.gridSnapDistance=20,l.isGrid=!0,t.$watch("[statediagram.isGrid , config.diagramm]",function(){l.drawGrid()},!0),l.drawGrid=function(){if(l.isGrid){l.svgGrid.html("");var e,a=l.svgOuter.style("width").replace("px",""),n=l.svgOuter.style("height").replace("px",""),i=1*t.config.diagramm.scale*.5,r=t.config.diagramm.x%(l.gridSpace*t.config.diagramm.scale),s=t.config.diagramm.y%(l.gridSpace*t.config.diagramm.scale);for(e=r;a>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line xgrid-line").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",n);for(e=s;n>e;e+=l.gridSpace*t.config.diagramm.scale)l.svgGrid.append("line").attr("stroke-width",i).attr("class","grid-line ygrid-line").attr("x1",0).attr("y1",e).attr("x2",a).attr("y2",e)}else l.svgGrid.html("")},l.defs=l.svg.append("svg:defs"),l.defs.append("svg:marker").attr("id","marker-end-arrow").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-create").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-animated").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-hover").attr("refX",7.5).attr("refY",3).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.defs.append("svg:marker").attr("id","marker-end-arrow-selection").attr("refX",4).attr("refY",3).attr("markerWidth",5).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,0 L0,6 L9,3 z"),l.resetAddActions=function(){l.closeStateMenu(),l.closeTransitionMenu(),l.svgOuter.on("click",null),l.inAddTransition=!1,l.inAddState=!1},l.addState=function(){l.resetAddActions(),l.svgOuter.on("mousemove",function(){l.selectedState.objReference.attr("transform","translate("+(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale)+" "+(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale)+")")}),l.selectedState=t.addStateWithPresets(-1e4,-1e4),l.selectedState.objReference.classed("state-in-creation",!0),l.svgOuter.on("click",function(){l.selectedState.objReference.classed("state-in-creation",!1),l.selectedState.x=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),l.selectedState.y=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),l.selectedState.objReference.attr("transform","translate("+l.selectedState.x+" "+l.selectedState.y+")"),l.svgOuter.on("mousemove",null),l.addSvgOuterClickListener(),l.preventSvgOuterClick=!1,t.safeApply()})},l.addTransition=function(){l.resetAddActions(),l.preventStateDragging=!0,d3.selectAll(".state").on("click",function(){if(l.mouseInState=!0,null===l.selectedState)l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.tmpTransition=l.svgTransitions.append("g").attr("class","transition"),l.tmpTransitionline=l.tmpTransition.append("path").attr("class","transition-line curvedLine in-creation").attr("marker-end","url(#marker-end-arrow-create)").attr("fill","none");else{var e=t.addTransition(l.selectedState.id,parseInt(d3.select(this).attr("object-id")),t.getNextTransitionName(l.selectedState.id));l.toggleState(l.selectedState.id,!1),l.tmpTransition.remove(),l.tmpTransition=null,l.tmpTransitionline=null,l.preventStateDragging=!1,l.addSvgOuterClickListener(),l.svgOuter.on("mousemove",null),d3.selectAll(".state").on("mouseover",null),d3.selectAll(".state").on("mouseleave",null),d3.selectAll(".state").on("click",l.openStateMenu),l.openTransitionMenu(e.id)}}),l.svgOuter.on("mousemove",function(){if(!l.mouseInState&&null!==l.selectedState){var e=(d3.mouse(this)[0]-t.config.diagramm.x)*(1/t.config.diagramm.scale),a=(d3.mouse(this)[1]-t.config.diagramm.y)*(1/t.config.diagramm.scale),n=l.bezierLine([[l.selectedState.x,l.selectedState.y],[e,a]]);l.tmpTransitionline.attr("d",n)}}),d3.selectAll(".state").on("mouseover",function(e){if(l.mouseInState=!0,null!==l.selectedState){var a=t.getStateById(d3.select(this).attr("object-id")),n={};n.fromState=l.selectedState.id,n.toState=a.id;var i=l.tmpTransitionline;if(l.existsDrawnTransition(l.selectedState.fromState,l.selectedState.toState)){var r=l.getDrawnTransition(n.fromState,n.toState);r.names.push(n.name),l.writeTransitionText(r.objReference.select(".transition-text"),r.names)}else if(n.fromState!=n.toState){var s=l.getTransitionDrawConfig(n);if(s.approachTransition){var o=l.getDrawnTransition(n.toState,n.fromState),c=l.getTransitionDrawConfig(o,!0);l.updateTransitionLines(o.objReference,c.path),o.objReference.select(".transition-text").attr("x",c.xText).attr("y",c.yText),l.otherTransition=o}i.attr("d",s.path)}else{var d=t.getArrayStateIdByStateId(n.fromState),u=t.config.states[d].x,f=t.config.states[d].y;i.attr("d",l.selfTransition(u,f))}l.tmpTransitionline.attr("x1",l.selectedState.x).attr("y1",l.selectedState.y).attr("x2",a.x).attr("y2",a.y)}}).on("mouseleave",function(){if(l.mouseInState=!1,null!==l.otherTransition&&void 0!==l.otherTransition){var t=l.getTransitionDrawConfig(l.otherTransition);l.updateTransitionLines(l.otherTransition.objReference,t.path),l.otherTransition.objReference.select(".transition-text").attr("x",t.xText).attr("y",t.yText)}})},l.renameState=function(e,a){var n=t.config.states[t.getArrayStateIdByStateId(e)],i=n.objReference;i.select("text").text(a)},l.removeState=function(e){l.closeStateMenu();var a=t.config.states[t.getArrayStateIdByStateId(e)],n=a.objReference;n.remove()},l.renameTransition=function(t,e,a,n){var i=l.getDrawnTransition(t,e),r=_.find(i.names,{id:a});r.name=n,l.writeTransitionText(i.objReference.select(".transition-text"),i.names)},l.removeTransition=function(e){var a=t.getTransitionById(e),n=l.getDrawnTransition(a.fromState,a.toState),i=l.getTransitionDrawConfig(a);if(l.closeTransitionMenu(),1===n.names.length){if(n.objReference.remove(),_.remove(t.config.drawnTransitions,function(t){return t==n}),i.approachTransition){var r=l.getDrawnTransition(a.toState,a.fromState),s=l.getTransitionDrawConfig(r,!1);l.updateTransitionLines(r.objReference,s.path),r.objReference.select(".transition-text").attr("x",s.xText).attr("y",s.yText),l.otherTransition=r}}else _.remove(n.names,function(t){return t.id==a.id}),l.writeTransitionText(n.objReference.select(".transition-text"),n.names),i=l.getTransitionDrawConfig(a),n.objReference.select(".transition-text").attr("x",i.xText).attr("y",i.yText),console.log(n),l.openTransitionMenu(n.names[n.names.length-1].id)},l.addFinalState=function(e){var a=t.getStateById(e);a.objReference.insert("circle",".state-circle").attr("class","final-state").attr("r",l.settings.finalStateRadius)},l.removeFinalState=function(e){var a=t.getStateById(e);a.objReference.select(".final-state").remove()},l.changeStartState=function(e){if(null!==t.config.startState){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove()}var n=t.getStateById(e);n.objReference.append("line").attr("class","transition-line start-line").attr("x1",0).attr("y1",-75).attr("x2",0).attr("y2",0-l.settings.stateRadius-4).attr("marker-end","url(#marker-end-arrow)")},l.removeStartState=function(e){var a=t.getStateById(t.config.startState);a.objReference.select(".start-line").remove(),t.config.startState=null,t.updateListener()},l.drawState=function(e){var a=t.getStateById(e),n=l.svgStates.append("g").attr("transform","translate("+a.x+" "+a.y+")").attr("class","state state-"+a.id).attr("object-id",a.id);n.append("circle").attr("class","state-circle").attr("r",l.settings.stateRadius),n.append("circle").attr("class","state-circle hover-circle").attr("r",l.settings.stateRadius),n.append("text").text(a.name).attr("class","state-text").attr("dominant-baseline","central").attr("text-anchor","middle");return a.objReference=n,n.on("click",l.openStateMenu).call(l.dragState),n},l.setStateClassAs=function(e,a,n){var i=t.getStateById(e).objReference;i.classed(n,a)},l.setTransitionClassAs=function(e,a,n){var i=t.getTransitionById(e),r=l.getDrawnTransition(i.fromState,i.toState).objReference;r.classed(n,a),a&&"animated-transition"==n?r.select(".transition-line").attr("marker-end","url(#marker-end-arrow-animated)"):r.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.setArrowMarkerTo=function(t,e){""!==e?t.select(".transition-line").attr("marker-end","url(#marker-end-arrow-"+e+")"):t.select(".transition-line").attr("marker-end","url(#marker-end-arrow)")},l.openStateMenu=function(){console.log("open state menu"),l.closeStateMenu(),l.closeTransitionMenu(),t.safeApply(),l.preventSvgOuterClick=!0,l.showStateMenu=!0,l.selectedState=t.getStateById(parseInt(d3.select(this).attr("object-id"))),l.toggleState(l.selectedState.id,!0),l.input={},l.input.state=l.selectedState,l.input.stateName=l.selectedState.name,l.input.startState=t.config.startState==l.selectedState.id,l.input.finalState=t.isStateAFinalState(l.selectedState.id),l.input.ttt="",l.input.tttisopen=!1,t.safeApply(),l.stateMenuListener=[],l.stateMenuListener.push(t.$watch("statediagram.input.startState",function(e,a){e!==a&&(l.input.startState?t.changeStartState(l.input.state.id):l.selectedState.id==t.config.startState&&t.removeStartState())})),l.stateMenuListener.push(t.$watch("statediagram.input.finalState",function(e,a){e!==a&&(l.input.finalState?t.addFinalState(l.input.state.id):t.removeFinalState(l.input.state.id))})),l.stateMenuListener.push(t.$watch("statediagram.input.stateName",function(e,a){if(l.input.tttisopen=!1,e!==a)if(""===e||t.existsStateWithName(e))""===e?(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_TOO_SHORT"):t.existsStateWithName(e,l.input.state.id)&&(l.input.tttisopen=!0,l.input.ttt="STATE_MENU.NAME_ALREADY_EXIST");else{!t.renameState(l.input.state.id,e)}}))},l.closeStateMenu=function(){_.forEach(l.stateMenuListener,function(t,e){t()}),null!==l.selectedState&&l.toggleState(l.selectedState.id,!1),l.stateMenuListener=null,l.showStateMenu=!1,l.input=null},l.toggleState=function(t,e){l.setStateClassAs(t,e,"active"),e===!1&&(l.selectedState=null)},l.dragState=d3.behavior.drag().on("dragstart",function(){l.dragAmount=0,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(1==d3.event.sourceEvent.which&&!l.preventStateDragging){l.dragAmount++;var e=d3.event.x,a=d3.event.y;if(l.snapping){var n=e-e%l.gridSpace,i=a-a%l.gridSpace;e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n,a=i):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i-l.gridSnapDistance&&a<i+l.gridSnapDistance?(e=n+l.gridSpace,a=i):e>n-l.gridSnapDistance&&e<n+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance?(e=n,a=i+l.gridSpace):e>n+l.gridSpace-l.gridSnapDistance&&e<n+l.gridSpace+l.gridSnapDistance&&a>i+l.gridSpace-l.gridSnapDistance&&a<i+l.gridSpace+l.gridSnapDistance&&(e=n+l.gridSpace,a=i+l.gridSpace)}if(l.dragAmount>1){d3.select(this).attr("transform","translate("+e+" "+a+")");var r=d3.select(this).attr("object-id"),s=t.getStateById(r);s.x=e,s.y=a,l.updateTransitionsAfterStateDrag(d3.select(this).attr("object-id"))}}}).on("dragend",function(){l.dragAmount>1&&t.safeApply()}),l.selfTransition=function(t,e){return l.bezierLine([[t-l.stateSelfReferenceNumber,e-l.stateSelfReferenceNumber],[t-l.stateSelfReferenceNumber-u,e-l.stateSelfReferenceNumber-f],[t-l.stateSelfReferenceNumber-u,e+l.stateSelfReferenceNumber+f],[t-l.stateSelfReferenceNumber,e+l.stateSelfReferenceNumber]])};var g=30;l.bezierLine=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("basis"),l.getTransitionDrawConfig=function(e,n){var c=3,u={};u.approachTransition=n||l.existsDrawnTransition(e.toState,e.fromState);var f,m=t.getStateById(e.fromState),g=t.getStateById(e.toState),S=t.isStateAFinalState(e.toState),p=m.x,v=m.y,h=g.x,T=g.y,x={x:h-p,y:T-v},y=Math.sqrt(x.x*x.x+x.y*x.y),A=l.settings.stateRadius/y;f=S?(l.settings.stateRadius+c+5)/y:(l.settings.stateRadius+c)/y,u.xStart=p+A*x.x,u.yStart=v+A*x.y,u.xEnd=h-f*x.x,u.yEnd=T-f*x.y,u.xDiff=h-p,u.yDiff=T-v,u.xMid=(p+h)/2,u.yMid=(v+T)/2,u.distance=Math.sqrt(u.xDiff*u.xDiff+u.yDiff*u.yDiff);var w,I,M={x:u.xMid-u.xStart,y:u.yMid-u.yStart,z:0},D={x:0,y:0,z:1},b={x:1,y:0,z:0};if(w=20,I=a(M,D),I=s(I),I=r(I,w),u.approachTransition){var C=d({x:u.xStart-p,y:u.yStart-v},{x:l.settings.stateRadius,y:0}),L=d({x:u.xEnd-h,y:u.yEnd-T},{x:l.settings.stateRadius,y:0});u.xStart=p+l.settings.stateRadius*Math.cos(i(C.upperAngle)),u.yStart=v-l.settings.stateRadius*Math.sin(i(C.upperAngle)),u.xEnd=h+l.settings.stateRadius*Math.cos(i(L.lowerAngle)),u.yEnd=T-l.settings.stateRadius*Math.sin(i(L.lowerAngle))}w=35,I=a(M,D),I=s(I),I=r(I,w),u.xMidCurv=I.x+u.xMid,u.yMidCurv=I.y+u.yMid;var k,R=(l.existsDrawnTransition(m.id,g.id),l.getDrawnTransition(m.id,g.id));k=R?R.names.length:1;var E,N,_=o(M,b),B=_.degree;B>90&&(B=90-B%90);var O=Math.pow(B/90,.5);E=u.approachTransition?40+8*k*O:12+8*k*O,N=a(M,D),N=s(N),N=r(N,E),u.xText=N.x+u.xMid,u.yText=N.y+u.yMid;var F=[];return F=u.approachTransition?[[u.xStart,u.yStart],[u.xMidCurv,u.yMidCurv],[u.xEnd,u.yEnd]]:[[u.xStart,u.yStart],[u.xEnd,u.yEnd]],u.path=l.bezierLine(F),u},l.writeTransitionText=function(e,a){e.selectAll("*").remove();for(var n=0;n<a.length;n++)null!==t.simulator.animated.transition&&a[n].id===t.simulator.animated.transition.id?e.append("tspan").attr("transition-id",a[n].id).text(a[n].name).classed("animated-transition-text",!0):e.append("tspan").attr("transition-id",a[n].id).text(a[n].name),n<a.length-1&&e.append("tspan").text(" | ")},l.drawTransition=function(e){var a=t.getTransitionById(e);if(!l.existsDrawnTransition(a.fromState,a.toState)){var n=l.svgTransitions.append("g").attr("class","transition"),i=(n.append("path").attr("class","transition-line-selection").attr("fill","none").attr("marker-end","url(#marker-end-arrow-selection)"),n.append("path").attr("class","transition-line").attr("fill","none").attr("marker-end","url(#marker-end-arrow)"),n.append("path").attr("class","transition-line-click").attr("stroke-width",20).attr("stroke","transparent").attr("fill","none"),n.append("path").attr("class","transition-line-hover").attr("fill","none").attr("marker-end","url(#marker-end-arrow-hover)"),n.append("text").attr("class","transition-text").attr("dominant-baseline","central").attr("fill","black"));if(a.fromState!=a.toState){var r=l.getTransitionDrawConfig(a);if(r.approachTransition){var s=l.getDrawnTransition(a.toState,a.fromState),o=l.getTransitionDrawConfig(s,!0);l.updateTransitionLines(s.objReference,o.path),s.objReference.select(".transition-text").attr("x",o.xText).attr("y",o.yText)}i.attr("class","transition-text").attr("x",r.xText).attr("y",r.yText),l.updateTransitionLines(n,r.path)}else{var c=t.getArrayStateIdByStateId(a.fromState),d=t.config.states[c].x,u=t.config.states[c].y;l.updateTransitionLines(n,l.selfTransition(d,u)),i.attr("x",d-l.settings.stateRadius-50).attr("y",u)}return n.attr("object-id",t.config.drawnTransitions.push({fromState:a.fromState,toState:a.toState,names:[{id:a.id,name:a.name}],objReference:n})-1),l.writeTransitionText(i,l.getDrawnTransition(a.fromState,a.toState).names),n.attr("from-state-id",a.fromState).attr("to-state-id",a.toState).on("click",l.openTransitionMenu).on("mouseover",function(){d3.select(this).select(".transition-line-hover").attr("style","opacity:0.6")}).on("mouseleave",function(){d3.select(this).select(".transition-line-hover").attr("style","")}),n}var f=l.getDrawnTransition(a.fromState,a.toState);f.names.push({id:a.id,name:a.name}),l.writeTransitionText(f.objReference.select(".transition-text"),l.getDrawnTransition(a.fromState,a.toState).names);var m=l.getTransitionDrawConfig(a);f.objReference.select(".transition-text").attr("x",m.xText).attr("y",m.yText)},l.updateTransitionLines=function(t,e){t.select(".transition-line").attr("d",e),t.select(".transition-line-selection").attr("d",e),t.select(".transition-line-hover").attr("d",e),t.select(".transition-line-click").attr("d",e)},l.openTransitionMenu=function(e){l.closeStateMenu(),l.closeTransitionMenu(),l.preventSvgOuterClick=!0,l.showTransitionMenu=!0;var a,n;if(void 0===e)a=d3.select(this).attr("from-state-id"),n=d3.select(this).attr("to-state-id"),l.selectedTransition=l.getDrawnTransition(a,n);else{var i=t.getTransitionById(e);a=i.fromState,n=i.toState,l.selectedTransition=l.getDrawnTransition(a,n)}l.selectedTransition.objReference.classed("active",!0),l.input={},l.input.fromState=t.getStateById(a),l.input.toState=t.getStateById(n),l.input.transitions=[],_.forEach(l.selectedTransition.names,function(t,a){var n={};n=cloneObject(t),void 0!==e?t.id==e&&(n.isFocus=!0):l.selectedTransition.names.length-1===a&&(n.isFocus=!0),n.ttt="",n.tttisopen=!1,l.input.transitions.push(n)}),l.transitionMenuListener=[];for(var r=0;r<l.input.transitions.length;r++)l.transitionMenuListener.push(t.$watchCollection("statediagram.input.transitions['"+r+"']",function(e,i){e.name!==i.name&&(e.tttisopen=!1,""===e.name||t.existsTransition(a,n,e.name)?""===e.name?(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_TOO_SHORT"):t.existsTransition(a,n,e.name,e.id)&&(e.tttisopen=!0,e.ttt="TRANS_MENU.NAME_ALREAD_EXISTS"):t.renameTransition(e.id,e.name),console.log(t.existsTransition(a,n,e.name,e.id)))}));t.safeApply()},l.closeTransitionMenu=function(){_.forEach(l.transitionMenuListener,function(t,e){t()}),l.showTransitionMenu=!1,null!==l.selectedTransition&&(l.selectedTransition.objReference.classed("active",!1),l.selectedTransition=null)},l.updateTransitionsAfterStateDrag=function(e){t.config.states[t.getArrayStateIdByStateId(e)].name;_.forEach(t.config.drawnTransitions,function(a,n){if(a.fromState==e||a.toState==e){var i=a.objReference,r=i.select("text");if(a.fromState!=a.toState){var s=l.getTransitionDrawConfig(a);l.updateTransitionLines(i,s.path),r.attr("x",s.xText).attr("y",s.yText)}else{var o=a.fromState,c=t.config.states[t.getArrayStateIdByStateId(o)].x,d=t.config.states[t.getArrayStateIdByStateId(o)].y;l.updateTransitionLines(i,l.selfTransition(c,d)),r.attr("x",c-l.settings.stateRadius-50).attr("y",d)}}})},t.$watch("simulator.animated.currentState",function(e,a){e!==a&&(console.log("CURRENTSTATE:oldValue "+a+" newvalue "+e),console.log("status"+t.simulator.status),null!==a&&(l.setStateClassAs(a,!1,"animated-currentstate-svg"),l.setStateClassAs(a,!1,"animated-accepted-svg"),l.setStateClassAs(a,!1,"animated-not-accepted-svg")),null!==e&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"):l.setStateClassAs(e,!0,"animated-currentstate-svg")))}),t.$watch("simulator.animated.transition",function(t,e){t!==e&&(null!==e&&(l.setTransitionClassAs(e.id,!1,"animated-transition"),d3.selectAll("[transition-id='"+e.id+"'").classed("animated-transition-text",!1)),null!==t&&(l.setTransitionClassAs(t.id,!0,"animated-transition"),console.log(t),d3.selectAll("[transition-id='"+t.id+"'").classed("animated-transition-text",!0)))}),t.$watch("simulator.animated.nextState",function(t,e){t!==e&&(console.log("NEXTSTATE: oldValue "+e+" newvalue "+t),null!==e&&l.setStateClassAs(e,!1,"animated-nextstate-svg"),null!==t&&l.setStateClassAs(t,!0,"animated-nextstate-svg"))}),t.$watch("simulator.status",function(e,a){e!==a&&("accepted"===t.simulator.status?l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-accepted-svg"):"not accepted"===t.simulator.status&&l.setStateClassAs(t.simulator.animated.currentState,!0,"animated-not-accepted-svg"))})}function StatetransitionfunctionDFA(t){"use strict";var e=this;e.functionData={},e.functionData.states=[],e.functionData.startState="",e.functionData.finalStates="",e.functionData.transitions="",e.functionData.statetransitionfunction=[],t.updateListeners.push(e),e.updateFunction=function(){var a,n="",i="",r="",s="";e.functionData.transitions=t.config.alphabet,e.functionData.states=[],_.forEach(t.config.states,function(a,i){n="";var r="";null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id&&(r="selected"),n+=a.id==t.simulator.animated.currentState&&"accepted"===t.simulator.status?'<span class="animated-accepted '+r+'">':a.id==t.simulator.animated.currentState&&"not accepted"===t.simulator.status?'<span class="animated-not-accepted '+r+'">':a.id==t.simulator.animated.currentState?'<span class="animated-currentstate '+r+'">':'<span class="'+r+'">',n+=a.name,n+="</span>",i<t.config.states.length-1&&(n+=", "),e.functionData.states.push(n)}),e.functionData.statetransitionfunction=[],_.forEach(t.config.states,function(a,n){
_.forEach(t.config.transitions,function(n,r){if(n.fromState===a.id){var s=n,o=!1;null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{id:n.id})&&(o=!0);var c=!1;t.simulator.animated.transition&&t.simulator.animated.transition.id===s.id&&(c=!0),i=c||o?'(<span class=" '+(c?"animated-transition":"")+" "+(o?"selected":"")+'">':"(<span>",i+=t.getStateById(s.fromState).name+", ",i+=s.name+", ",i+=t.getStateById(s.toState).name+"</span>)",e.functionData.statetransitionfunction.push(i)}})}),a=t.getStateById(t.config.startState),void 0!==a&&(r+='<span class="">'+a.name+"</span>"),e.functionData.startState=r,_.forEach(t.config.finalStates,function(e,a){e=t.getStateById(e),s=e.name,a<t.config.finalStates.length-1&&(s+=", ")}),e.functionData.finalStates=s},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.status",function(t,a){t!==a&&e.updateFunction()})}function TableDFA(t){var e=this;e.states=[],t.updateListeners.push(e),e.updateFunction=function(){e.states=[],e.alphabet=[];t.config;_.forEach(t.config.alphabet,function(a,n){var i="";null!==t.statediagram.selectedTransition&&void 0!==_.find(t.statediagram.selectedTransition.names,{name:a})&&(i="selected");var r;r=t.simulator.animated.transition&&t.simulator.animated.transition.name===a?'<span class="animated-transition '+i+'">'+a+"</span>":'<span class="'+i+'">'+a+"</span>",e.alphabet.push(r)}),_.forEach(t.config.states,function(a,n){var i={};i.id=a.id;var r="";if((null!==t.statediagram.selectedState&&t.statediagram.selectedState.id==a.id||null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.fromState===a.id)&&(r="selected"),t.simulator.animated.currentState==a.id){var s="";s="accepted"===t.simulator.status?"animated-accepted":"not accepted"===t.simulator.status?"animated-not-accepted":"animated-currentstate",i.name='<span class="'+s+" "+r+'">'+a.name+"</span>"}else i.name='<span class="'+r+'">'+a.name+"</span>";t.isStateAFinalState(a.id)?i.finalState=!0:i.finalState=!1,t.config.startState===a.id?i.startState=!0:i.startState=!1,i.trans=[],_.forEach(t.config.alphabet,function(e,n){var r=null;_.forEach(t.config.transitions,function(t,n){t.fromState===a.id&&t.name===e&&(r=t)});var s={};if(s.alphabet=e,null!==r){var o=t.getStateById(r.toState),c="";null!==t.statediagram.selectedTransition&&t.statediagram.selectedTransition.toState===o.id&&(c="selected"),t.simulator.animated.nextState==o.id&&r.name==t.simulator.animated.transition.name?s.State='<span class="animated-nextstate '+c+'">'+o.name+"</span>":s.State='<span class="'+c+'">'+o.name+"</span>"}else s.State="";i.trans.push(s)}),e.states.push(i)})},t.$watch("simulator.animated.currentState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.transition",function(t,a){t!==a&&e.updateFunction()}),t.$watch("simulator.animated.nextState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedState",function(t,a){t!==a&&e.updateFunction()}),t.$watch("statediagram.selectedTransition",function(t,a){t!==a&&e.updateFunction()})}